<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>topictool – Language Technology and Data Analysis Laboratory (LADAL)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script>
    // Wait for the document to be fully loaded
    document.addEventListener("DOMContentLoaded", function () {
        // Create a new div element to hold the dynamic content
        var newContainer = document.createElement("div");
        newContainer.classList.add("custom-banner");  // You can assign a class to the new container for styling

        // You can also add content inside the new container
        newContainer.innerHTML = `
          <div class="banner">
              <img src="images/ladal_icon_white.png" alt="Icon" class="banner-icon">
              <span class="banner-text">Language Technology and Data Analysis Laboratory</span>
          </div>
      `

        // Select the header element
        var header = document.getElementById("quarto-header");

        // Select the nav element inside the header to place the new container just above it
        var navbar = header.querySelector("nav");

        // Insert the new container before the navbar element
        header.insertBefore(newContainer, navbar);
    });
</script>


<link rel="stylesheet" href="../../css/styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Language Technology and Data Analysis Laboratory (LADAL)</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">HOME</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">ABOUT</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../events.html"> 
<span class="menu-text">EVENTS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html"> 
<span class="menu-text">TUTORIALS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tools.html"> 
<span class="menu-text">TOOLS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">RESOURCES</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact.html"> 
<span class="menu-text">CONTACT</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#topic-model-tool" id="toc-topic-model-tool" class="nav-link active" data-scroll-target="#topic-model-tool">Topic-Model Tool</a>
  <ul class="collapse">
  <li><a href="#using-your-own-data" id="toc-using-your-own-data" class="nav-link" data-scroll-target="#using-your-own-data">Using your own data</a></li>
  <li><a href="#cleaning-and-tokenising" id="toc-cleaning-and-tokenising" class="nav-link" data-scroll-target="#cleaning-and-tokenising">Cleaning and tokenising</a></li>
  <li><a href="#unsupervised-lda" id="toc-unsupervised-lda" class="nav-link" data-scroll-target="#unsupervised-lda">Unsupervised LDA</a></li>
  <li><a href="#supervised-lda" id="toc-supervised-lda" class="nav-link" data-scroll-target="#supervised-lda">Supervised LDA</a></li>
  <li><a href="#exporting-data-2" id="toc-exporting-data-2" class="nav-link" data-scroll-target="#exporting-data-2">Exporting data</a></li>
  </ul></li>
  <li><a href="#citation-session-info" id="toc-citation-session-info" class="nav-link" data-scroll-target="#citation-session-info">Citation &amp; Session Info</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/uq1.jpg" class="img-fluid figure-img"></p>
<figcaption>An interactive LADAL notebook</figcaption>
</figure>
</div>
<section id="topic-model-tool" class="level1">
<h1>Topic-Model Tool</h1>
<p>This notebook-based tool accompanies the <a href="tutorials/topicmodels/topicmodels.html">Language Technology and Data Analysis Laboratory (LADAL) tutorial <em>Topic Modelling R</em></a>.</p>
<section id="using-your-own-data" class="level2">
<h2 class="anchored" data-anchor-id="using-your-own-data">Using your own data</h2>
<div class="warning" style="padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
To <b>use your own data</b>, click on the folder called <b><code>MyTexts</code></b> (it is in the menu to the left of the screen) and then simply drag and drop your txt-files into the folder. <br>When you then execute the code chunk below, you will upload your own data and you can then use it in this notebook.<br>You can upload <b>only txt-files</b> (simple unformatted files created in or saved by a text editor)! <br>The notebook assumes that you upload some form of text data - not tabular data!<br><br> <b>IMPORTANT: topic modeling works best if the texts are neither too short nor too long. Typically paragraphs work best (texts above sentence level and below article length).</b> <br>
</p>
<p style="margin-left:1em;">
</p>
<p></p>
</span></div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load function that helps loading texts</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tools/topictool/rscripts/loadtxts.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/laurenceanthony/Documents/projects/LADALQ</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Package version: 4.1.0
Unicode version: 14.0
ICU version: 71.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Parallel computing: disabled</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>See https://quanteda.io for tutorials and examples.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: proxyC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'proxyC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    dist</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'seededlda'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:quanteda':

    info_tbb</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    terms</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load texts</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">loadtxts</span>(<span class="st">"notebooks/MyTexts"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the structure of the text object</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Named chr [1:7] "Linguistics is the scientific study of language. It involves analysing language form language meaning and langu"| __truncated__ ...
 - attr(*, "names")= chr [1:7] "linguistics01.txt" "linguistics02.txt" "linguistics03.txt" "linguistics04.txt" ...</code></pre>
</div>
</div>
</section>
<section id="cleaning-and-tokenising" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-and-tokenising">Cleaning and tokenising</h2>
<p>We start by cleaning the corpus data (by removing tags, artefacts and non-alpha-numeric characters), then splitting the clean corpora into individual words, and creating a document-frequency matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load function that helps loading texts</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tools/topictool/rscripts/preptop.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidytext</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: topicmodels</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'topicmodels'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:seededlda':

    perplexity, topics</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean corpus and convert to dfm</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>clean_dfm <span class="ot">&lt;-</span> <span class="fu">preptop</span>(corpus)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unsupervised-lda" class="level2">
<h2 class="anchored" data-anchor-id="unsupervised-lda">Unsupervised LDA</h2>
<p>Now that we have cleaned the data, we can perform the topic modelling. This consists of two steps:</p>
<ol type="1">
<li><p>First, we perform an unsupervised LDA. We do this to check what topics are in our corpus.</p></li>
<li><p>Then, we perform a supervised LDA (based on the results of the unsupervised LDA) to identify meaningful topics in our data. For the supervised LDA, we define so-called <em>seed terms</em> that help in generating coherent topics.</p></li>
</ol>
<div class="warning" style="padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
<b>In the code below, the default is to look for 5 topics but you will need to vary and adapt the number of topics (k) for your data and check what topics are in your data.</b> <br>
</p>
<p></p>
</span></div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate model: change k to different numbers, e.g. 10 or 15 and look for consistencies in the keywords for the topics below.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tmlda <span class="ot">&lt;-</span> topicmodels<span class="sc">::</span><span class="fu">LDA</span>(clean_dfm, <span class="at">k =</span> <span class="dv">5</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">seed =</span> <span class="dv">1234</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the topic model has been generated, we can inspect which terms correlate most strongly with each topic. The code chunk below will display the top 10 terms for each topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load function that tabulates top terms of topics</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tools/topictool/rscripts/tabtop.R"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tabtop</span>(tmlda, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Values from `term` are not uniquely identified; output will contain list-cols.
• Use `values_fn = list` to suppress this warning.
• Use `values_fn = {summary_fun}` to summarise duplicates.
• Use the following dplyr code to identify duplicates.
  {data} |&gt;
  dplyr::summarise(n = dplyr::n(), .by = c(top, topic)) |&gt;
  dplyr::filter(n &gt; 1L)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   top    `topic 1` `topic 2` `topic 3` `topic 4` `topic 5`
   &lt;fct&gt;  &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
 1 top 1  &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 2 top 2  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [7]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 3 top 3  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
 4 top 4  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 5 top 5  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 6 top 6  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 7 top 7  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 8 top 8  &lt;chr [5]&gt; &lt;chr [5]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
 9 top 9  &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
10 top 10 &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [6]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;</code></pre>
</div>
</div>
<p>We now extract a table with the probabilities of each term to occur in each of the topics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>termprobs_tmlda <span class="ot">&lt;-</span> tidytext<span class="sc">::</span><span class="fu">tidy</span>(tmlda, <span class="at">matrix =</span> <span class="st">"beta"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(termprobs_tmlda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  topic term             beta
  &lt;int&gt; &lt;chr&gt;           &lt;dbl&gt;
1     1 linguistics 1.82e-  2
2     2 linguistics 1.59e-  2
3     3 linguistics 1.27e-  2
4     4 linguistics 2.90e-  2
5     5 linguistics 1.92e-216
6     1 scientific  1.98e-223</code></pre>
</div>
</div>
<section id="exporting-data" class="level3">
<h3 class="anchored" data-anchor-id="exporting-data">Exporting data</h3>
<p>To export a data frame as an MS Excel spreadsheet, we use <code>write_xlsx</code>. Be aware that we use the <code>here</code> function to save the file in the current working directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data for MyOutput folder</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(termprobs_tmlda, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"notebooks/MyOutput/termprobs_tmlda.xlsx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="warning" style="padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
<b>You will find the generated MS Excel spreadsheet named “termprobs_tmlda.xlsx” in the <code>MyOutput</code> folder (located on the left side of the screen).</b> <br><br>Simply double-click the <code>MyOutput</code> folder icon, then right-click on the “termprobs_tmlda.xlsx” file, and choose Download from the dropdown menu to download the file. <br>
</p>
<p style="margin-left:1em;">
</p>
<p></p>
</span></div>
<p><br></p>
<p>Before turning to the supervised LDA topic model, you can extract the probability of topics in each document. For this, we use the <em>gamma</em> statistic</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>docprobs_tmlda <span class="ot">&lt;-</span> <span class="fu">tidy</span>(tmlda, <span class="at">matrix =</span> <span class="st">"gamma"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(docprobs_tmlda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  document topic    gamma
  &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;
1 text1        1 0.000196
2 text2        1 0.000351
3 text3        1 0.000245
4 text4        1 0.999   
5 text5        1 0.000209
6 text6        1 0.000165</code></pre>
</div>
</div>
</section>
<section id="exporting-data-1" class="level3">
<h3 class="anchored" data-anchor-id="exporting-data-1">Exporting data</h3>
<p>To export a data frame as an MS Excel spreadsheet, we use <code>write_xlsx</code>. Be aware that we use the <code>here</code> function to save the file in the current working directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data for MyOutput folder</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(docprobs_tmlda, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"notebooks/MyOutput/docprobs_tmlda.xlsx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="warning" style="padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
<b>You will find the generated MS Excel spreadsheet named “docprobs_tmlda.xlsx” in the <code>MyOutput</code> folder (located on the left side of the screen).</b> <br><br>Simply double-click the <code>MyOutput</code> folder icon, then right-click on the “docprobs_tmlda.xlsx” file, and choose Download from the dropdown menu to download the file. <br>
</p>
<p style="margin-left:1em;">
</p>
<p></p>
</span></div>
<p><br></p>
</section>
</section>
<section id="supervised-lda" class="level2">
<h2 class="anchored" data-anchor-id="supervised-lda">Supervised LDA</h2>
<p>Now, we perform a supervised LDA. Here we use the keywords extracted based on the unsupervised LDA as <em>seed terms</em> for topics to create coherent topics.</p>
<div class="warning" style="padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
<b>IMPORTANT: you need to change and adapt the topics and keywords defined below </b> <br>Simply replace the topics and seed terms with your own topics and seed terms (based on the results of the unsupervised LDA!). <br>
</p>
<p></p>
</span></div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># semisupervised LDA</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>dict <span class="ot">&lt;-</span> <span class="fu">dictionary</span>(<span class="fu">list</span>(<span class="at">Topic01 =</span> <span class="fu">c</span>(<span class="st">"computer"</span>, <span class="st">"information"</span>, <span class="st">"technology"</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Topic02 =</span> <span class="fu">c</span>(<span class="st">"students"</span>, <span class="st">"courses"</span>, <span class="st">"education"</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Topic03 =</span> <span class="fu">c</span>(<span class="st">"movie"</span>, <span class="st">"film"</span>, <span class="st">"watch"</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Topic04 =</span> <span class="fu">c</span>(<span class="st">"women"</span>, <span class="st">"feminist"</span>, <span class="st">"equality"</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Topic05 =</span> <span class="fu">c</span>(<span class="st">"money"</span>, <span class="st">"investment"</span>, <span class="st">"finance"</span>)))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>tmod_slda <span class="ot">&lt;-</span> seededlda<span class="sc">::</span><span class="fu">textmodel_seededlda</span>(clean_dfm, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                                            dict, </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">residual =</span> <span class="cn">TRUE</span>, </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">min_termfreq =</span> <span class="dv">2</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>tmod_slda<span class="sc">$</span>theta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Topic01     Topic02     Topic03     Topic04    Topic05      other
text1 0.115853659 0.006097561 0.493902439 0.006097561 0.34756098 0.03048780
text2 0.053191489 0.010638298 0.351063830 0.308510638 0.26595745 0.01063830
text3 0.159090909 0.113636364 0.022727273 0.613636364 0.02272727 0.06818182
text4 0.474137931 0.094827586 0.060344828 0.215517241 0.04310345 0.11206897
text5 0.409090909 0.058441558 0.006493506 0.006493506 0.27922078 0.24025974
text6 0.005154639 0.469072165 0.036082474 0.005154639 0.29381443 0.19072165
text7 0.052083333 0.052083333 0.156250000 0.031250000 0.32291667 0.38541667</code></pre>
</div>
</div>
<p>Now, we extract files and create a data frame of topics and documents. This shows what topic is dominant in which file in tabular form.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">rownames</span>(clean_dfm)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cleancontent <span class="ot">&lt;-</span> corpus</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>topics <span class="ot">&lt;-</span> <span class="fu">apply</span>(tmod_slda<span class="sc">$</span>theta, <span class="dv">1</span>, which.max)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data frame</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(files, cleancontent, topics) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.character, factor)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  files
linguistics01.txt text1
linguistics02.txt text2
linguistics03.txt text3
linguistics04.txt text4
linguistics05.txt text5
linguistics06.txt text6
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     cleancontent
linguistics01.txt                                                                                                                                                                                                                                Linguistics is the scientific study of language. It involves analysing language form language meaning and language in context. The earliest activities in the documentation and description of language have been attributed to the th-century-BC Indian grammarian Pa?ini who wrote a formal description of the Sanskrit language in his A??adhyayi. Linguists traditionally analyse human language by observing an interplay between sound and meaning. Phonetics is the study of speech and non-speech sounds and delves into their acoustic and articulatory properties. The study of language meaning on the other hand deals with how languages encode relations between entities properties and other aspects of the world to convey process and assign meaning as well as manage and resolve ambiguity. While the study of semantics typically concerns itself with truth conditions pragmatics deals with how situational context influences the production of meaning.
linguistics02.txt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Grammar is a system of rules which governs the production and use of utterances in a given language. These rules apply to sound as well as meaning, and include componential subsets of rules, such as those pertaining to phonology (the organisation of phonetic sound systems), morphology (the formation and composition of words), and syntax (the formation and composition of phrases and sentences). Many modern theories that deal with the principles of grammar are based on Noam Chomsky's framework of generative linguistics.
linguistics03.txt                                                                                                                                                                                                                                                                                                                                                                                                                                  In the early 20th century, Ferdinand de Saussure distinguished between the notions of langue and parole in his formulation of structural linguistics. According to him, parole is the specific utterance of speech, whereas langue refers to an abstract phenomenon that theoretically defines the principles and system of rules that govern a language. This distinction resembles the one made by Noam Chomsky between competence and performance in his theory of transformative or generative grammar. According to Chomsky, competence is an individual's innate capacity and potential for language (like in Saussure's langue), while performance is the specific way in which it is used by individuals, groups, and communities (i.e., parole, in Saussurean terms).
linguistics04.txt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The study of parole (which manifests through cultural discourses and dialects) is the domain of sociolinguistics, the sub-discipline that comprises the study of a complex system of linguistic facets within a certain speech community (governed by its own set of grammatical rules and laws). Discourse analysis further examines the structure of texts and conversations emerging out of a speech community's usage of language. This is done through the collection of linguistic data, or through the formal discipline of corpus linguistics, which takes naturally occurring texts and studies the variation of grammatical and other features based on such corpora (or corpus data).
linguistics05.txt                                                                                                                                                                                                                                                                               Stylistics also involves the study of written, signed, or spoken discourse through varying speech communities, genres, and editorial or narrative formats in the mass media. In the 1960s, Jacques Derrida, for instance, further distinguished between speech and writing, by proposing that written language be studied as a linguistic medium of communication in itself. Palaeography is therefore the discipline that studies the evolution of written scripts (as signs and symbols) in language. The formal study of language also led to the growth of fields like psycholinguistics, which explores the representation and function of language in the mind; neurolinguistics, which studies language processing in the brain; biolinguistics, which studies the biology and evolution of language; and language acquisition, which investigates how children and adults acquire the knowledge of one or more languages.
linguistics06.txt Linguistics also deals with the social, cultural, historical and political factors that influence language, through which linguistic and language-based context is often determined. Research on language through the sub-branches of historical and evolutionary linguistics also focus on how languages change and grow, particularly over an extended period of time. Language documentation combines anthropological inquiry (into the history and culture of language) with linguistic inquiry, in order to describe languages and their grammars. Lexicography involves the documentation of words that form a vocabulary. Such a documentation of a linguistic vocabulary from a particular language is usually compiled in a dictionary. Computational linguistics is concerned with the statistical or rule-based modeling of natural language from a computational perspective. Specific knowledge of language is applied by speakers during the act of translation and interpretation, as well as in language education � the teaching of a second or foreign language. Policy makers work with governments to implement new plans in education and teaching which are based on linguistic research.
                  topics
linguistics01.txt      3
linguistics02.txt      3
linguistics03.txt      4
linguistics04.txt      1
linguistics05.txt      1
linguistics06.txt      2</code></pre>
</div>
</div>
</section>
<section id="exporting-data-2" class="level2">
<h2 class="anchored" data-anchor-id="exporting-data-2">Exporting data</h2>
<p>To export a data frame as an MS Excel spreadsheet, we use <code>write_xlsx</code>. Be aware that we use the <code>here</code> function to save the file in the current working directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save data for MyOutput folder</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(df, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"notebooks/MyOutput/df.xlsx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="warning" style="padding:0.1em; background-color: rgba(215,209,204,.3); color:#51247a">
<span>
<p style="margin-top:1em; text-align:center">
<b>You will find the generated MS Excel spreadsheet named “df.xlsx” in the <code>MyOutput</code> folder (located on the left side of the screen).</b> <br><br>Simply double-click the <code>MyOutput</code> folder icon, then right-click on the “df.xlsx” file, and choose Download from the dropdown menu to download the file. <br>
</p>
<p style="margin-left:1em;">
</p>
<p></p>
</span></div>
<p><br></p>
<hr>
</section>
</section>
<section id="citation-session-info" class="level1">
<h1>Citation &amp; Session Info</h1>
<p>Schweinberger, Martin. (2024)` <em>LADAL Topic-Model Tool</em>. Brisbane: The University of Queensland. url: tools.html (Version 2024.04.21).</p>
<pre><code>@manual{schweinberger2024topictool,
  author = {Schweinberger, Martin},
  title = {LADAL Topic-Model Tool},
  note = {tools.html},
  year = {2024},
  organization = {The University of Queensland, School of Languages and Cultures},
  address = {Brisbane},
  edition = {2024.04.21}
}</code></pre>
<p><a href="tutorials/topicmodels/topicmodels.html">Back to LADAL</a></p>
<hr>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Silge, J., &amp; Robinson, D. (2017). Topic modeling. In J. Silge &amp; D. Robinson (Eds.), <em>Text Mining with R</em>. O’Reilly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14)
Platform: aarch64-apple-darwin20
Running under: macOS Sonoma 14.6.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Australia/Brisbane
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] topicmodels_0.2-17        tidytext_0.4.2           
 [3] writexl_1.5.1             tidyr_1.3.1              
 [5] stringr_1.5.1             seededlda_1.4.1          
 [7] proxyC_0.4.1              quanteda.textstats_0.97.2
 [9] quanteda.textplots_0.95   quanteda_4.1.0           
[11] here_1.0.1                ggplot2_3.5.1            
[13] dplyr_1.1.4              

loaded via a namespace (and not attached):
 [1] janeaustenr_1.0.0 utf8_1.2.4        generics_0.1.3    xml2_1.3.6       
 [5] slam_0.1-54       stringi_1.8.4     lattice_0.22-6    digest_0.6.37    
 [9] magrittr_2.0.3    evaluate_1.0.1    grid_4.4.1        fastmap_1.2.0    
[13] plyr_1.8.9        rprojroot_2.0.4   jsonlite_1.8.9    Matrix_1.7-1     
[17] tm_0.7-14         stopwords_2.3     purrr_1.0.2       fansi_1.0.6      
[21] scales_1.3.0      codetools_0.2-20  modeltools_0.2-23 cli_3.6.3        
[25] rlang_1.1.4       tokenizers_0.3.0  munsell_0.5.1     withr_3.0.2      
[29] parallel_4.4.1    NLP_0.3-0         tools_4.4.1       reshape2_1.4.4   
[33] colorspace_2.1-1  fastmatch_1.1-4   vctrs_0.6.5       R6_2.5.1         
[37] stats4_4.4.1      lifecycle_1.0.4   htmlwidgets_1.6.4 pkgconfig_2.0.3  
[41] pillar_1.9.0      gtable_0.3.6      glue_1.8.0        Rcpp_1.0.13      
[45] xfun_0.49         tibble_3.2.1      tidyselect_1.2.1  knitr_1.48       
[49] htmltools_0.5.8.1 SnowballC_0.7.1   rmarkdown_2.28    compiler_4.4.1   
[53] nsyllable_1.0.1  </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>